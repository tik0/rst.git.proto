
INCLUDE(PedanticCompilerWarnings)

# Configure and install pkg-config module file
CONFIGURE_FILE("${CMAKE_CURRENT_SOURCE_DIR}/${CPP_NAME}.pc.in"
               "${CMAKE_CURRENT_BINARY_DIR}/${CPP_NAME}.pc"
	           @ONLY)
INSTALL(FILES       "${CMAKE_CURRENT_BINARY_DIR}/${CPP_NAME}.pc"
        DESTINATION lib/pkgconfig)

PROTOBUF_GENERATE(CPP CPP_PROTO_SOURCES CPP_PROTO_HEADERS
                  EXPORT_MACRO RST_EXPORT
                  PROTOFILES ${RSTFILES}
                  PROTOROOT ${PROTO_ROOT}
                  OUTPATH ${CMAKE_CURRENT_BINARY_DIR})

INCLUDE_DIRECTORIES(BEFORE SYSTEM ${PROTOBUF_INCLUDE_DIRS})
INCLUDE_DIRECTORIES(BEFORE ${CMAKE_CURRENT_BINARY_DIR})

# decide on export macros
IF(WIN32)
    ADD_DEFINITIONS("/DRST_EXPORT=__declspec(dllexport)")
ELSE()
    ADD_DEFINITIONS("-DRST_EXPORT=")
ENDIF()

ADD_LIBRARY(${CPP_NAME} SHARED ${CPP_PROTO_SOURCES} ${CPP_PROTO_HEADERS})
TARGET_LINK_LIBRARIES(${CPP_NAME} ${PROTOBUF_LIBRARIES})
INSTALL(TARGETS ${CPP_NAME}
        EXPORT RSTDepends
        ARCHIVE DESTINATION lib
        LIBRARY DESTINATION lib
        RUNTIME DESTINATION bin)

INSTALL(FILES ${CPP_PROTO_HEADERS} DESTINATION include/rst)
