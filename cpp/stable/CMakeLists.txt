
CONFIGURE_FILE("${CMAKE_CURRENT_SOURCE_DIR}/${STABLE_NAME}.pc.in"
               "${CMAKE_CURRENT_BINARY_DIR}/${STABLE_NAME}.pc"
               @ONLY)
INSTALL(FILES "${CMAKE_CURRENT_BINARY_DIR}/${STABLE_NAME}.pc"
        DESTINATION lib/pkgconfig)

INCLUDE_DIRECTORIES(BEFORE ${CMAKE_CURRENT_BINARY_DIR})

PROTOBUF_GENERATE(CPP CPP_STABLE_SOURCES CPP_STABLE_HEADERS
                  EXPORT_MACRO RST_EXPORT
                  PROTOFILES ${STABLE_PROTOS}
                  PROTOROOT ${STABLE_ROOT}
                  OUTPATH ${CMAKE_CURRENT_BINARY_DIR})

ADD_LIBRARY(${STABLE_NAME} SHARED ${CPP_STABLE_SOURCES} ${CPP_STABLE_HEADERS})
TARGET_LINK_LIBRARIES(${STABLE_NAME} ${PROTOBUF_LIBRARIES})
INSTALL(TARGETS ${STABLE_NAME}
        EXPORT RSTDepends
        ARCHIVE DESTINATION lib
        LIBRARY DESTINATION lib
        RUNTIME DESTINATION bin)

CONFIGURE_FILE(RSTConfig.cmake.in "${CMAKE_CURRENT_BINARY_DIR}/RSTConfig.cmake" @ONLY)
INSTALL(FILES "${CMAKE_CURRENT_BINARY_DIR}/RSTConfig.cmake" DESTINATION share/rst)
EXPORT(TARGETS ${STABLE_NAME} FILE "${CMAKE_BINARY_DIR}/RSTDepends.cmake")
INSTALL(EXPORT RSTDepends
        DESTINATION "share/rst")

INSTALL_FILES_RECURSIVE("include/rst/" CPP_STABLE_HEADERS)
